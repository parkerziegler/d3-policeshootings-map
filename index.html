<!DOCTYPE html>
<meta charset="utf-8">
<style>

#title-container {
  left: 900px;
  width: 350px;
  height: 300px;
  position: absolute;
}

#page-title {
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;
  font-size: 30px;
  color: black;
  position: absolute;
}

#page-title-2 {
  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", Helvetica, sans-serif;
  font-size: 20px;
  color: #999;
  position: absolute;
  top: 90px;
}

#title-container-2 {
  left: 900px;
  width: 350px;
  height: 300px;
  position: absolute;
  top: 620px;
}

#page-title-3{
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;
  font-size: 30px;
  color: black;
  position: absolute;
}

#state-container{
  position:absolute;
  top: 500px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#percap-container{
  position:absolute;
  top: 555px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#state-name{
  font-family: "HelveticaNeue-Bold";
  font-size: 40px;
  color: #333333;
}

#percap-shootings{
  font-family: "HelveticaNeue-Bold";
  font-size: 30px;
  color: #333333;
}

#map-container-circles {
  position: absolute;
  top: 620px;
}

#state-container-2 {
  position:absolute;
  top: 1100px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#total-container{
  position:absolute;
  top: 1155px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#state-name-2 {
  font-family: "HelveticaNeue-Bold";
  font-size: 40px;
  color: #333333;
}

#total-shootings {
  font-family: "HelveticaNeue-Bold";
  font-size: 30px;
  color: #333333;
}

.states {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
  stroke-width: 0.5;
}

.states-invisible {
  fill: none;
  stroke: none;
}

.state-labels {
  font-family: "HelveticaNeue-Light", Helvetica, sans-serif;
  font-size: 8px;
  color: #fff;
}

path:hover {
	fill-opacity: .7;
}

circle:hover {
  fill-opacity: 1;
}

</style>
<body>
<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<div id="title-container">
  <h1 id="page-title">Police Involved Shootings Per Million</h1>
  <h1 id="page-title-2">January 1, 2015 â€“ July 9, 2016</h1>
</div>
<div id="map-container"></div>
<div id="state-container">
  <h1 id="state-name">New Mexico</h1>
</div>
<div id="percap-container">
  <h1 id="percap-shootings">17.26 shootings per million</h1>
</div>
<div id="map-container-circles"></div>
<div id="title-container-2">
  <h1 id="page-title-3">Police Involved Shootings (Raw Count)</h1>
</div>
<div id="state-container-2">
  <h1 id="state-name-2">California</h1>
</div>
<div id="total-container">
  <h1 id="total-shootings">285 shootings</h1>
</div>

<script>

// set the height and width of the svg
var width = 960,
    height = 500;

// set the projection
var projection = d3.geoAlbersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);

// set the path
var path = d3.geoPath()
    .projection(projection);

// create an empty dataset variable
var dataset;

// append the svg
var svg = d3.select("#map-container").append("svg")
    .attr("width", width)
    .attr("height", height);

// create a function to assign fill color based on values
var quantize = function(d){
  if(d < 1){
    return "rgb(247,251,255)";
  }
  else if(d < 3){
    return "rgb(222,235,247)";
  }
  else if(d < 5){
    return "rgb(198,219,239)";
  }
  else if(d < 7){
    return "rgb(158,202,225)";
  }
  else if(d < 10){
    return "rgb(107,174,214)";
  }
  else {
    return "rgb(66,146,198)";
  }
};

// load the data
d3.json("usa.geojson", function(error, usa) {
  if (error) return console.error(error);
  console.log(usa);
  dataset = usa.features;

  svg.append("g")
      .attr("class", "states")
      .selectAll("path")
      .data(dataset)
      .enter()
      .append("path")
      .attr("fill", function(d) {
        return quantize(d.properties.per_mil);
      })
      .attr("d", path)
      .on("mouseover", function(e){

          d3.select("#state-name")
            .data(dataset)
            .text(function(){
              return e.properties.NAME;
            });

          d3.select("#percap-shootings")
            .data(dataset)
            .text(function(){
              return e.properties.per_mil + ' shootings per million';
            });

      });

  svg.append("path")
      .datum(dataset)
      .attr("d", path);

});

// position the svg
$("svg").css({left: "25%"});

// create a second svg for graduated circles
var svgCircles = d3.select("#map-container-circles").append("svg")
    .attr("width", width)
    .attr("height", height);

// load the data
d3.json("usa.geojson", function(error, usa) {
  if (error) return console.error(error);
  console.log(usa);
  dataset = usa.features;

  svgCircles.append("g")
      .attr("class", "states-invisible")
      .selectAll("circle")
      .data(dataset)
      .enter()
      .append("circle")
      .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
      .attr("r", function(d){ return 125 * Math.sqrt(d.properties.shootings)/Math.sqrt(285)})
      .attr("stroke", "white")
      .attr("stroke-width", 0.5)
      .attr("fill", "#B24739")
      .attr("fill-opacity", 0.5)
      .on("mouseover", function(e){

          d3.select("#state-name-2")
            .data(dataset)
            .text(function(){
              return e.properties.NAME;
            });

          d3.select("#total-shootings")
            .data(dataset)
            .text(function(){
              return e.properties.shootings + ' shootings';
            });
        })

  // now add some labels
  svgCircles.append("g")
      .selectAll("text")
      .data(dataset)
      .enter()
      .append("text")
      .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
      .attr("class", "state-labels")
      .text(function(d){ return d.properties.STUSPS });

});



</script>
