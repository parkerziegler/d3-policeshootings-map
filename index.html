<!DOCTYPE html>
<meta charset="utf-8">
<style>

#page-title {
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;
  font-size: 30px;
  color: black;
  position: fixed;
  display: inline-block;
  padding-left: 10px;
  padding-bottom: 15px;
  overflow: hidden;
  white-space: nowrap;
  z-index: 9000;
}

#page-title-2 {
  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", Helvetica, sans-serif;
  font-size: 30px;
  color: #999;
  position: fixed;
  display: inline-block;
  left: 690px;
  padding-bottom: 15px;
  overflow: hidden;
  white-space: nowrap;
  z-index: 9000;
}

#page-title-3{
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;
  font-size: 30px;
  color: black;
  position: absolute;
}

#title-container {
  width: 100%;
  height: 60px;
  position: fixed;
  background-color: #FFE800;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  z-index: 9000;
}

#title-container-2 {
  left: 900px;
  width: 350px;
  height: 300px;
  position: absolute;
  top: 620px;
}

#map-container{
  top: 70px;
  position: absolute;
}

#sidebar-title{
  font-family: "Gill Sans MT", Helvetica, sans-serif;;
  font-size: 30px;
  color: #333333;
  position:absolute;
  top: 70px;
  left: 900px;
  overflow: hidden;
  white-space: nowrap;
}

#state-title{
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;;
  font-size: 30px;
  color: #333333;
  position:absolute;
  top: 330px;
  left: 900px;
  overflow: hidden;
  white-space: nowrap;
}

#percap-title{
  font-family: "HelveticaNeue-Bold", Helvetica, sans-serif;;
  font-size: 20px;
  color: #666;
  position:absolute;
  top: 375px;
  left: 900px;
  overflow: hidden;
  white-space: nowrap;
}

#description{
  font-family: "Palatino Linotype", "Book Antigua", Palatino, serif;
  font-size: 14px;
  color: #333;
  position: absolute;
  top: 160px;
  left: 900px;
  overflow: hidden;
  white-space: nowrap;
}

#percap-bars {
  position: absolute;
  top: 400px;
  left: 900px;
}

#map-container-circles {
  position: absolute;
  top: 690px;
}

#state-container-2 {
  position:absolute;
  top: 1170px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#total-container{
  position:absolute;
  top: 1225px;
  height: 100px;
  width: 960px;
  left: 100px;
}

#state-name-2 {
  font-family: "HelveticaNeue-Bold";
  font-size: 40px;
  color: #333333;
}

#total-shootings {
  font-family: "HelveticaNeue-Bold";
  font-size: 30px;
  color: #333333;
}

.states {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
  stroke-width: 0.5;
}

.states-invisible {
  fill: none;
  stroke: none;
}

.state-labels {
  font-family: "HelveticaNeue-Light", Helvetica, sans-serif;
  font-size: 8px;
  color: #fff;
}

path:hover {
	fill-opacity: .7;
}

circle:hover {
  fill-opacity: 1;
}

</style>
<body>
<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<div id="title-container">
  <h1 id="page-title">Police Involved Shootings in the United States</h1><h1 id="page-title-2">January 1, 2015 â€“ July 9, 2016</h1>
</div>
<div id="map-container"></div>
<h1 id="sidebar-title">Shootings per <br> Million by State</h1>
<p id="description">Between January 1, 2015 and July 9, 2016, <b>1,715</b> <br> people were killed by police in the United States.<br> That amounts to roughly <b>3.1 people per day</b>. <br><br><b>New Mexico</b> had the highest normalized rate <br> of police involved shootings in this time period, <br>with <b>17.26</b> for every million residents.<br><br> Hover over a state to obtain its rate.</p>
<h1 id="state-title">New Mexico</h1>
<h1 id="percap-title">17.26 shootings per million</h1>
<div id="percap-bars"></div>
<div id="map-container-circles"></div>
<div id="title-container-2">
  <h1 id="page-title-3">Police Involved Shootings (Raw Count)</h1>
</div>
<div id="state-container-2">
  <h1 id="state-name-2">California</h1>
</div>
<div id="total-container">
  <h1 id="total-shootings">285 shootings</h1>
</div>

<script>

// set the height and width of the map svg
var width = 960,
    height = 500;

// set the projection
var projection = d3.geoAlbersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);

// set the path
var path = d3.geoPath()
    .projection(projection);

// create an empty dataset variable
var dataset;

// append the main map svg
var svg = d3.select("#map-container").append("svg")
    .attr("width", width)
    .attr("height", height);

// set the height and width of the bar chart svg
var margin = {top: 35, right: 35, bottom: 35, left: 35},
    wBar = 300 - margin.left - margin.right,
    hBar = 370 - margin.top - margin.bottom;

// create the bar chart svg
var svgBar = d3.select("#percap-bars").append("svg")
    .attr("width", wBar)
    .attr("height", hBar);

// create a function to assign fill color based on values
var quantize = function(d){
  if(d < 1){
    return "rgb(247,251,255)";
  }
  else if(d < 3){
    return "rgb(222,235,247)";
  }
  else if(d < 5){
    return "rgb(198,219,239)";
  }
  else if(d < 7){
    return "rgb(158,202,225)";
  }
  else if(d < 10){
    return "rgb(107,174,214)";
  }
  else {
    return "rgb(66,146,198)";
  }
};

// load the data
d3.json("usa.geojson", function(error, usa) {
  if (error) return console.error(error);
  console.log(usa);
  dataset = usa.features;

  svg.append("g")
      .attr("class", "states")
      .selectAll("path")
      .data(dataset)
      .enter()
      .append("path")
      .attr("fill", function(d) {
        return quantize(d.properties.per_mil);
      })
      .attr("d", path)
      .on("mouseover", function(e){

          d3.select("#state-title")
            .data(dataset)
            .text(function(){
              return e.properties.NAME;
            });

          d3.select("#percap-title")
            .data(dataset)
            .text(function(){
              return e.properties.per_mil + ' shootings per million';
            });

      });

  svg.append("path")
      .datum(dataset)
      .attr("d", path);

// now for the bar chat; start with defining the scales
var xScale = d3.scaleLinear()
                    .domain([0, d3.max(dataset, function(d){
                        return d.properties.per_mil;
                    })])
                    .range([0, wBar]);

var yScale = d3.scaleOrdinal()
              .domain(d3.range(dataset.length))
              .range([0, hBar]);

// now create the bar chart
svgBar.selectAll("rect")
  .data(dataset)
  .enter()
  .append("rect")
  .attr("x", margin.left)
  .attr("y", function(d, i) {
    return yScale(i) + margin.top/2;
  })
  .attr("width", function(d){
    return xScale(d.properties.per_mil);
  })
  .attr("height", yScale)
  .attr("fill", "black");

});

// create a second svg for graduated circles
var svgCircles = d3.select("#map-container-circles").append("svg")
    .attr("width", width)
    .attr("height", height);

// load the data
d3.json("usa.geojson", function(error, usa) {
  if (error) return console.error(error);
  console.log(usa);
  dataset = usa.features;

  svgCircles.append("g")
      .attr("class", "states-invisible")
      .selectAll("circle")
      .data(dataset)
      .enter()
      .append("circle")
      .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
      .attr("r", function(d){ return 100 * Math.sqrt(d.properties.shootings)/Math.sqrt(285)})
      .attr("stroke", "white")
      .attr("stroke-width", 0.5)
      .attr("fill", "#B24739")
      .attr("fill-opacity", 0.5)
      .on("mouseover", function(e){

          d3.select("#state-name-2")
            .data(dataset)
            .text(function(){
              return e.properties.NAME;
            });

          d3.select("#total-shootings")
            .data(dataset)
            .text(function(){
              return e.properties.shootings + ' shootings';
            });
        })

  // now add some labels
  svgCircles.append("g")
      .selectAll("text")
      .data(dataset)
      .enter()
      .append("text")
      .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
      .attr("class", "state-labels")
      .text(function(d){ return d.properties.STUSPS });

});



</script>
